angular.module("booksCart",["ngRoute"]).run(function(t,e){t.$on("$routeChangeStart",function(t,o,r){e.clear()})}),angular.module("booksCart").config(function(t){t.when("/",{controller:"BookListCtrl as ctrl",templateUrl:"templates/book-list.html"}).when("/cart",{controller:"CartCtrl as ctrl",templateUrl:"templates/cart.html"}).when("/login",{controller:"LoginCtrl as ctrl",templateUrl:"templates/login.html"}).when("/orders",{controller:"OrderCtrl as ctrl",templateUrl:"templates/orders.html"}).when("/book/add",{controller:"BookAddCtrl as ctrl",templateUrl:"templates/book-add.html"}).otherwise({redirectTo:"/"})}),angular.module("booksCart").controller("BookAddCtrl",function(t,e){var o=this;o.addBook=function(){o.newBook.price=parseInt(o.newBook.price),t.add(o.newBook).then(function(){e.success(o.newBook.title+" created successfully")})}}),angular.module("booksCart").controller("BookListCtrl",function(t,e,o){function r(){t.getAll().then(function(t){n.books=t.data})}var n=this;r(),n.addToCart=function(t){o.success(t.title+" added to cart"),e.add(t)}}),angular.module("booksCart").controller("CartCtrl",function(t,e,o,r){this.cart=t.getCart(),this.increaseQuantity=function(t){t.quantity++,this.cart.totalQuantity++,this.cart.totalPrice+=t.price,r.success("increased")},this.decreaseQuantity=function(t){t.quantity>0&&(t.quantity--,this.cart.totalQuantity--,this.cart.totalPrice-=t.price)},this.placeOrder=function(){e.createOrder(this.cart).then(function(t){r.success("Order placed successfully")},function(t){401==t.status&&(console.log(" => "),r.error("Please login first"))})}}),angular.module("booksCart").controller("HeaderCtrl",function(t,e,o,r){this.cart=t.getCart(),this.alert=r.getAlert(),this.isLoggedIn=function(){return e.isLoggedIn()},this.logout=function(){e.logout(),console.log("logged out successfully"),o.path("/login")}}),angular.module("booksCart").controller("LoginCtrl",function(t,e){var o=this;o.user={username:"admin",password:"admin"},o.login=function(){t.login(o.user).then(function(t){e.success("Login successful")})}}),angular.module("booksCart").controller("OrderCtrl",function(t,e,o){var r=this;t.getAll().then(function(t){r.orders=t.data},function(t){401==t.status&&(e.path("/login"),o.error("You need to login to see your orders"))})}),angular.module("booksCart").directive("expandableSummary",function(){return{restrict:"E",templateUrl:"templates/expandable-summary.html",scope:{order:"="},link:function(t,e,o){t.showDetails=function(){t.detailShown=!t.detailShown}}}}),angular.module("booksCart").filter("titlecase",function(){return function(t){return t=t||"",t.toString().toLowerCase().replace(/\b([a-z])/g,function(t){return t.toUpperCase()})}}),angular.module("booksCart").service("AlertService",function(){var t={type:"",message:""};this.getAlert=function(){return t},this.success=function(e){t.type="success",t.message=e},this.error=function(e){t.type="error",t.message=e},this.clear=function(){t.type="",t.message=""}}),angular.module("booksCart").service("AuthService",function(t){var e="http://localhost:3000/login",o={};this.login=function(r){return t.post(e,r).then(function(t){return console.log("setting token",t.data.token),o.token=t.data.token,t})},this.getToken=function(){return o.token},this.getAuth=function(){return o},this.isLoggedIn=function(){return void 0!==o.token},this.logout=function(){o.token=void 0}}),angular.module("booksCart").service("BookService",function(t){var e="http://localhost:3000/book";this.getAll=function(){return t.get(e)},this.add=function(o){return t.post(e,o)}}),angular.module("booksCart").service("CartService",function(){var t={items:[],totalQuantity:0,totalPrice:0},e=function(e){for(var o=0;o<t.items.length;o++)if(t.items[o]&&t.items[o].bookId==e)return o};this.getCart=function(){return t},this.add=function(o){var r=e(o.id);void 0!==r?t.items[r].quantity++:t.items.push({bookId:o.id,title:o.title,price:o.price,quantity:1}),t.totalPrice+=o.price,t.totalQuantity+=1}}),angular.module("booksCart").service("OrderService",function(t,e){var o="http://localhost:3000/api/v1/orders";this.createOrder=function(r){var n=e.getToken();return r.createdAt=new Date,t.post(o,r,{headers:{"X-Access-Token":n}})},this.getAll=function(){var r=e.getToken();return t.get(o,{headers:{"X-Access-Token":r}})}});